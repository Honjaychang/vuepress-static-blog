<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTP-Browser | HonjayChang</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/photo.ico">
    <meta name="description" content="厚积而薄发">
    
    <link rel="preload" href="/assets/css/0.styles.101e93c3.css" as="style"><link rel="preload" href="/assets/js/app.8db34c63.js" as="script"><link rel="preload" href="/assets/js/2.983698d7.js" as="script"><link rel="preload" href="/assets/js/34.3b003f35.js" as="script"><link rel="prefetch" href="/assets/js/10.53f50f72.js"><link rel="prefetch" href="/assets/js/11.14ae67e3.js"><link rel="prefetch" href="/assets/js/12.8bd1e098.js"><link rel="prefetch" href="/assets/js/13.81e2b1b5.js"><link rel="prefetch" href="/assets/js/14.89bf0b9b.js"><link rel="prefetch" href="/assets/js/15.c965b4da.js"><link rel="prefetch" href="/assets/js/16.6253e22c.js"><link rel="prefetch" href="/assets/js/17.f2d1d7ed.js"><link rel="prefetch" href="/assets/js/18.d194ed84.js"><link rel="prefetch" href="/assets/js/19.9dfc0424.js"><link rel="prefetch" href="/assets/js/20.38e0a8e2.js"><link rel="prefetch" href="/assets/js/21.29b30efb.js"><link rel="prefetch" href="/assets/js/22.70e339a1.js"><link rel="prefetch" href="/assets/js/23.481c7338.js"><link rel="prefetch" href="/assets/js/24.47652bca.js"><link rel="prefetch" href="/assets/js/25.66e7da71.js"><link rel="prefetch" href="/assets/js/26.162bb288.js"><link rel="prefetch" href="/assets/js/27.5a4ab791.js"><link rel="prefetch" href="/assets/js/28.e7411d81.js"><link rel="prefetch" href="/assets/js/29.9144167b.js"><link rel="prefetch" href="/assets/js/3.363d4551.js"><link rel="prefetch" href="/assets/js/30.1265b18a.js"><link rel="prefetch" href="/assets/js/31.c8454f4e.js"><link rel="prefetch" href="/assets/js/32.5e3e87b4.js"><link rel="prefetch" href="/assets/js/33.8f3137a0.js"><link rel="prefetch" href="/assets/js/35.840eb4e9.js"><link rel="prefetch" href="/assets/js/36.df15f5f0.js"><link rel="prefetch" href="/assets/js/37.aaea4be9.js"><link rel="prefetch" href="/assets/js/38.352ad4cb.js"><link rel="prefetch" href="/assets/js/39.e72d78d1.js"><link rel="prefetch" href="/assets/js/4.d38cbe0d.js"><link rel="prefetch" href="/assets/js/40.dff4d77e.js"><link rel="prefetch" href="/assets/js/5.b570c556.js"><link rel="prefetch" href="/assets/js/6.c9f44ce5.js"><link rel="prefetch" href="/assets/js/7.5da1919b.js"><link rel="prefetch" href="/assets/js/8.c43efb22.js"><link rel="prefetch" href="/assets/js/9.d8640715.js">
    <link rel="stylesheet" href="/assets/css/0.styles.101e93c3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/photo.jpg" alt="HonjayChang" class="logo"> <span class="site-name can-hide">HonjayChang</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/FE/" class="nav-link">
  FE
</a></div><div class="nav-item"><a href="/interview/" class="nav-link router-link-active">
  INTE
</a></div><div class="nav-item"><a href="/dev/" class="nav-link">
  DEV
</a></div><div class="nav-item"><a href="/DS/" class="nav-link">
  DS
</a></div><div class="nav-item"><a href="https://honjaychang.github.io/VuePress/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Link
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/FE/" class="nav-link">
  FE
</a></div><div class="nav-item"><a href="/interview/" class="nav-link router-link-active">
  INTE
</a></div><div class="nav-item"><a href="/dev/" class="nav-link">
  DEV
</a></div><div class="nav-item"><a href="/DS/" class="nav-link">
  DS
</a></div><div class="nav-item"><a href="https://honjaychang.github.io/VuePress/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Link
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/interview/" aria-current="page" class="sidebar-link">HTML</a></li><li><a href="/interview/CSS.html" class="sidebar-link">CSS</a></li><li><a href="/interview/JS.html" class="sidebar-link">JavaScript</a></li><li><a href="/interview/Web-API.html" class="sidebar-link">Web-API</a></li><li><a href="/interview/HTTP-Browser.html" aria-current="page" class="active sidebar-link">HTTP-Browser</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/HTTP-Browser.html#http状态码" class="sidebar-link">HTTP状态码</a></li><li class="sidebar-sub-header"><a href="/interview/HTTP-Browser.html#http-method" class="sidebar-link">HTTP Method</a></li><li class="sidebar-sub-header"><a href="/interview/HTTP-Browser.html#get和post的区别" class="sidebar-link">Get和Post的区别？</a></li><li class="sidebar-sub-header"><a href="/interview/HTTP-Browser.html#http首部" class="sidebar-link">HTTP首部</a></li><li class="sidebar-sub-header"><a href="/interview/HTTP-Browser.html#http-缓存策略" class="sidebar-link">HTTP 缓存策略</a></li><li class="sidebar-sub-header"><a href="/interview/HTTP-Browser.html#运行环境" class="sidebar-link">运行环境</a></li><li class="sidebar-sub-header"><a href="/interview/HTTP-Browser.html#性能优化" class="sidebar-link">性能优化</a></li><li class="sidebar-sub-header"><a href="/interview/HTTP-Browser.html#安全" class="sidebar-link">安全</a></li></ul></li><li><a href="/interview/network.html" class="sidebar-link">计网</a></li><li><a href="/interview/hand.html" class="sidebar-link">各种手写</a></li><li><a href="/interview/quize.html" class="sidebar-link">作用域和自由变量</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="http-browser"><a href="#http-browser" class="header-anchor">#</a> HTTP-Browser</h1> <h2 id="http状态码"><a href="#http状态码" class="header-anchor">#</a> HTTP<a href="HTTPs://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status">状态码</a></h2> <h4 id="分类"><a href="#分类" class="header-anchor">#</a> 分类</h4> <table><thead><tr><th style="text-align:left;">分类</th> <th style="text-align:left;">分类描述</th></tr></thead> <tbody><tr><td style="text-align:left;">1**</td> <td style="text-align:left;">信息响应，服务器收到请求，需要请求者继续执行操作</td></tr> <tr><td style="text-align:left;">2**</td> <td style="text-align:left;">成功响应，操作被成功接收并处理</td></tr> <tr><td style="text-align:left;">3**</td> <td style="text-align:left;">重定向，需要进一步的操作以完成请求</td></tr> <tr><td style="text-align:left;">4**</td> <td style="text-align:left;">客户端错误，请求包含语法错误或无法完成请求</td></tr> <tr><td style="text-align:left;">5**</td> <td style="text-align:left;">服务器错误，服务器在处理请求的过程中发生了错误</td></tr></tbody></table> <h4 id="常见状态码"><a href="#常见状态码" class="header-anchor">#</a> 常见状态码</h4> <ul><li>200 - 请求成功</li> <li>204 - 请求处理成功，但没有资源可返回</li> <li>206 - 对资源的某一部分进行请求</li> <li>301 - 资源被永久转移到其它URL(永久重定向到新的location)</li> <li>302 - 资源临时移动(临时重定向)</li> <li>304 - 所请求的资源未修改</li> <li>307 - 临时重定向</li> <li>400 - 请求报文存在语法错误</li> <li>403 - 没有权限</li> <li>404 - 请求的资源不存在</li> <li>500 - 内部服务器错误</li> <li>502 - 网关错误</li> <li>504 - 网关超时</li></ul> <h2 id="http-method"><a href="#http-method" class="header-anchor">#</a> HTTP Method</h2> <h4 id="传统的-methods"><a href="#传统的-methods" class="header-anchor">#</a> 传统的 methods</h4> <ul><li><code>get</code> 获取服务器的数据</li> <li><code>post</code> 向服务器提交数据</li></ul> <h4 id="现在的-methods"><a href="#现在的-methods" class="header-anchor">#</a> 现在的 methods</h4> <ul><li><code>get</code> 获取数据</li> <li><code>post</code> 新建数据</li> <li><code>patch/put</code> 更新数据</li> <li><code>delete</code> 删除数据</li></ul> <h4 id="restful-api"><a href="#restful-api" class="header-anchor">#</a> Restful API</h4> <ul><li><p>传统API设计:把每个url当做一个功能</p></li> <li><p>Restful API设计:一种新的API设计方法，把每个url当做一个唯一的资源</p></li> <li><p>如何设计成一个资源？</p> <ul><li>尽量不用url参数</li></ul> <div class="language-basic line-numbers-mode"><pre class="language-basic"><code>传统API设计<span class="token punctuation">:</span> <span class="token operator">/</span>api<span class="token operator">/</span>list?pageIndex<span class="token operator">=</span><span class="token number">2</span>
Restful API设计<span class="token punctuation">:</span> <span class="token operator">/</span>api<span class="token operator">/</span>list<span class="token operator">/</span><span class="token number">2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>用method表示操作类型</li></ul> <div class="language-basic line-numbers-mode"><pre class="language-basic"><code>传统API设计<span class="token punctuation">:</span> 
post请求	<span class="token operator">/</span>api<span class="token operator">/</span>create<span class="token operator">-</span>blog
post请求	<span class="token operator">/</span>api<span class="token operator">/</span>update<span class="token operator">-</span>blog?id<span class="token operator">=</span><span class="token number">100</span>
<span class="token keyword">get</span>请求	<span class="token operator">/</span>api<span class="token operator">/</span><span class="token keyword">get</span><span class="token operator">-</span>blog?id<span class="token operator">=</span><span class="token number">100</span>

Restful API设计<span class="token punctuation">:</span> 
post请求	<span class="token operator">/</span>api<span class="token operator">/</span>blog
patch请求	 <span class="token operator">/</span>api<span class="token operator">/</span>blog<span class="token operator">/</span><span class="token number">100</span>
<span class="token keyword">get</span>请求	<span class="token operator">/</span>api<span class="token operator">/</span>blog<span class="token operator">/</span><span class="token number">100</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul> <h2 id="get和post的区别"><a href="#get和post的区别" class="header-anchor">#</a> Get和Post的区别？</h2> <ul><li>缓存：<code>get</code>请求的数据是可以缓存的；<code>post</code>是不可缓存的。</li> <li>功能
<ul><li><code>get</code>请求类似于查找的过程，用户获取数据，可以不用每次都与数据库连接，所以可以使用缓存。</li> <li><code>post</code>做的一般是修改和删除的工作，所以必须与数据库交互，所以不能使用缓存。</li></ul></li> <li>传参：<code>get</code>传参，参数是在url中的；<code>post</code>传参，参数是在请求体中。</li> <li>安全性：<code>get</code>不安全，<code>post</code>较为安全：<code>post</code>易于防止<code>CSRF</code>。</li> <li>参数长度：<code>get</code>参数长度有限，是较小的；<code>post</code>传参长度不受限制。</li></ul> <h4 id="get请求传参长度的误区"><a href="#get请求传参长度的误区" class="header-anchor">#</a> get请求传参长度的误区</h4> <p><strong>误区</strong>：我们经常说get请求参数的大小存在限制，而post请求的参数大小是无限制的。</p> <ul><li><p><code>HTTP</code>协议未规定<code>GET</code>和<code>POST</code>的请求长度限制</p></li> <li><p><code>GET</code>的最大长度显示是因为：浏览器和web服务器限制了URL的长度</p></li> <li><p>不同的浏览器和WEB服务器，限制的最大长度不一样</p></li> <li><p>要支持<code>IE</code>，则最大长度为<code>2083byte</code>，若只支持<code>Chrome</code>，则最大长度 <code>8182byte</code></p></li></ul> <h2 id="http首部"><a href="#http首部" class="header-anchor">#</a> HTTP首部</h2> <ul><li><p><code>HTTP</code> 请求报文：请求方法、<code>URI</code>、<code>HTTP</code>版本、<code>HTTP</code>首部字段</p></li> <li><p><code>HTTP</code> 响应报文：<code>HTTP</code>版本、状态码、<code>HTTP</code>首部字段</p></li></ul> <h4 id="http首部字段"><a href="#http首部字段" class="header-anchor">#</a> <code>HTTP</code>首部字段</h4> <ul><li>首部字段名：字段值</li></ul> <h4 id="通用首部字段"><a href="#通用首部字段" class="header-anchor">#</a> 通用首部字段</h4> <ul><li><code>Cache-Control</code> ：能够控制缓存的行为</li> <li><code>Connection</code> <ul><li>控制不再转发给代理的首部字段</li> <li>管理持久连接 <code>Connection: Keep-Alive / close</code>  一次TCP连接重复使用</li></ul></li> <li><code>Date</code>：表明创建 HTTP 报文的日期和时间</li> <li><code>Warning</code>：会告知用户一些与缓存相关的问题的警告</li></ul> <h4 id="请求首部字段"><a href="#请求首部字段" class="header-anchor">#</a> 请求首部字段</h4> <ul><li><code>Accept</code>：告知服务器，用户代理能够处理的媒体类型及媒体类型的相对优先级
<ul><li><code>Accept-Charset</code>：优先的字符集</li> <li><code>Accept-Encoding</code>：可接收的压缩算法 <code>gzip</code></li> <li><code>Accept-Language</code>：<code>zh-cn</code></li></ul></li> <li><code>Authorization</code>：Web 认证信息</li> <li><code>Host</code>：请求的域名是什么</li> <li><code>User-Agent</code>：浏览器信息</li> <li><code>If-Match If-Modified-Since If-None-Match If-Range</code></li> <li><code>Cookie</code></li></ul> <h4 id="响应首部字段"><a href="#响应首部字段" class="header-anchor">#</a> 响应首部字段</h4> <ul><li><code>ETag</code>：资源的匹配信息</li> <li><code>Location</code>：提供重定向<code>url</code></li> <li><code>Server</code>：HTTP服务器的安装信息</li> <li><code>Set-Cookie</code></li></ul> <h4 id="实体首部字段"><a href="#实体首部字段" class="header-anchor">#</a> 实体首部字段</h4> <ul><li><p>包含在请求报文和响应报文中的实体部分所使用的首部，用于补充内容的更新时间等与实体相关的信息</p></li> <li><p><code>Content-Type: text/html</code></p></li> <li><p><code>Keep-Alive: timeout=15, max=100</code></p></li> <li><p><code>Allow</code>：请求资源允许使用的方法</p></li> <li><p><code>Content</code></p> <ul><li><code>Content-Encoding</code>：返回数据的压缩算法，如 <code>gzip</code></li> <li><code>Content-Language</code></li> <li><code>Content-Length</code></li> <li><code>Content-Type</code>：返回 / 发送数据的格式，如<code>application/json</code></li></ul></li> <li><p><code>Expires Last-Modified</code></p></li></ul> <h4 id="缓存相关"><a href="#缓存相关" class="header-anchor">#</a> 缓存相关</h4> <div class="language-text line-numbers-mode"><pre class="language-text"><code>Cache-Control	Expires
Last-Modified If-Modified-Since
Etag	If-None-Match
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="http-缓存策略"><a href="#http-缓存策略" class="header-anchor">#</a> HTTP 缓存策略</h2> <h4 id="浏览器的三级缓存"><a href="#浏览器的三级缓存" class="header-anchor">#</a> 浏览器的三级缓存</h4> <ul><li>内存 =&gt; 磁盘 =&gt; 网络请求</li></ul> <h4 id="强制缓存"><a href="#强制缓存" class="header-anchor">#</a> 强制缓存</h4> <ul><li><p>在过期时间内，未被主动清除 都不会请求服务器 而使用强制缓存 =&gt; 协商缓存</p></li> <li><p><code>200 from disk cache</code> <code>200 from memory cache</code></p></li></ul> <h5 id="cache-control"><a href="#cache-control" class="header-anchor">#</a> <code>cache-control</code></h5> <ul><li><code>max-age</code>：浏览器可以接收生存期不大于指定时间（秒）的响应</li> <li><code>no-cache</code>：不用强制缓存，让服务端缓存</li> <li><code>no-store</code>：不用强制缓存，也不让服务端缓存</li> <li><code>private</code>：允许终端用户</li> <li><code>public</code>：允许中间代理</li></ul> <h5 id="expires"><a href="#expires" class="header-anchor">#</a> <code>Expires</code></h5> <ul><li>同为控制缓存过期。如果 <code>cache-control</code> 与 <code>expires</code> 同时存在的话，<code>cache-control</code> 的优先级高于<code>expires</code></li></ul> <h4 id="协商缓存-对比缓存"><a href="#协商缓存-对比缓存" class="header-anchor">#</a> 协商缓存（对比缓存）</h4> <ul><li>浏览器和服务器协商，每次都需要和服务器通信</li> <li>第一次请求时，服务器会返回资源和一个资源的缓存标识</li> <li>第二次请求时，浏览器会先将缓存标识发给服务器  然后服务器对标识进行匹配
<ul><li>不匹配 =&gt; 资源有更新 =&gt; 服务器返回新资源和新的缓存标识</li> <li>匹配 =&gt; 资源未更改 =&gt; 返回304状态码 读取本地浏览器缓存</li></ul></li></ul> <h5 id="last-modified"><a href="#last-modified" class="header-anchor">#</a> <code>Last-Modified</code></h5> <ul><li>对应 <code>If-Modified-Since</code></li> <li>响应资源的最后修改时间 只能精确到秒级</li></ul> <h5 id="etag"><a href="#etag" class="header-anchor">#</a> <code>Etag</code></h5> <ul><li>对应 <code>If-None-Match</code></li> <li><code>Etag</code>是服务器响应请求时，返回当前资源文件的一个唯一标识(类似指纹 由服务器生成)</li> <li>同时存在 会优先使用 <code>Etag</code></li> <li>如果资源被重复生成，而内容不变，则<code>Etag</code>更精确</li></ul> <h5 id="浏览器加载js文件有缓存"><a href="#浏览器加载js文件有缓存" class="header-anchor">#</a> 浏览器加载<code>JS</code>文件有缓存</h5> <ul><li>浏览器加载js文件是根据路径加载，首先根据路径在缓存里查找</li> <li>解决办法：打包时加一些哈希值 or 版本号</li></ul> <p><code>Ref</code>：</p> <ul><li><a href="https://blog.csdn.net/i13738612458/article/details/80383390?utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-1.control&amp;dist_request_id=&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-1.control" target="_blank" rel="noopener noreferrer">js 浏览器缓存机制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/feiyu_may/article/details/88376945" target="_blank" rel="noopener noreferrer">浏览器缓存带来的前端项目更新问题及解决方法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h5 id="刷新操作对缓存的影响"><a href="#刷新操作对缓存的影响" class="header-anchor">#</a> 刷新操作对缓存的影响</h5> <ul><li>正常操作:
<ul><li>地址栏输入<code>url</code>，跳转链接，前进后退等</li> <li>强制缓存有效，协商缓存有效</li></ul></li> <li>手动刷新:
<ul><li><code>F5</code>，点击刷新按钮，右击菜单刷新</li> <li>强制缓存失效，协商缓存有效</li></ul></li> <li>强制刷新:
<ul><li><code>ctrl + F5</code></li> <li>强制缓存失效，协商缓存失效</li></ul></li></ul> <h2 id="运行环境"><a href="#运行环境" class="header-anchor">#</a> 运行环境</h2> <h4 id="网页加载过程"><a href="#网页加载过程" class="header-anchor">#</a> 网页加载过程</h4> <h5 id="渲染过程"><a href="#渲染过程" class="header-anchor">#</a> 渲染过程</h5> <ul><li>根据 <code>HTML</code> 代码生成 <code>DOM Tree</code></li> <li>根据 <code>CSS</code> 代码生成 <code>CSSOM</code> <ul><li><code>css</code> 不会阻塞<code>DOM</code>树的解析</li> <li><code>css</code> 加载会阻塞<code>DOM</code>树渲染</li></ul></li> <li>将 <code>DOM Tree</code> 和 <code>CSSOM</code> 整合形成 <code>Render Tree</code></li> <li>根据 <code>Render Tree</code> 渲染页面</li> <li>遇到  <code>&lt;script&gt;</code> 则暂停渲染，优先加载并执行<code>JS</code>代码，完成再继续</li> <li>直至把 <code>Render Tree</code> 渲染完成</li></ul> <h5 id="为什么要将-css-link-href-放在head中"><a href="#为什么要将-css-link-href-放在head中" class="header-anchor">#</a> 为什么要将 <code>CSS &lt;link href=&quot;#&quot;&gt;</code> 放在head中</h5> <ul><li>在<code>DOM</code>树生成前就将<code>CSS</code>规则加载完</li> <li>在<code>DOM</code>生成完成后直接和所有的<code>CSS</code>规则整合 =&gt; 一步渲染完成 <code>Render Tree</code></li></ul> <h5 id="为何建议将js放在body最后"><a href="#为何建议将js放在body最后" class="header-anchor">#</a> 为何建议将<code>JS</code>放在<code>body</code>最后</h5> <ul><li>不放在最后的话，<code>JS</code> 代码会阻塞 <code>render tree</code> 的渲染，可能会导致页面渲染时间比较长</li></ul> <p><code>Ref</code></p> <ul><li><a href="https://segmentfault.com/a/1190000018130499" target="_blank" rel="noopener noreferrer">css加载会造成阻塞吗<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h5 id="图片的加载不会阻塞dom渲染过程"><a href="#图片的加载不会阻塞dom渲染过程" class="header-anchor">#</a> 图片的加载不会阻塞DOM渲染过程</h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token number">111</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>img src <span class="token operator">=</span> <span class="token string">&quot;test.png&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> <span class="token comment">//图片的加载不会阻塞DOM渲染过程</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token number">222</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="window-onload-和-domcontentloaded的区别"><a href="#window-onload-和-domcontentloaded的区别" class="header-anchor">#</a> <code>window.onload</code> 和 <code>DOMContentLoaded</code>的区别</h4> <ul><li>建议使用<code>document.addEventListener('DOMContentLoaded', fn(){...})</code></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 页面的全部资源加载完成后才会执行，包括图片、视频等</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// DOM 渲染完成即可执行，此时图片、视频可能还没有加载完</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="什么是回流-什么是重绘"><a href="#什么是回流-什么是重绘" class="header-anchor">#</a> 什么是回流 什么是重绘？</h4> <ul><li>回流<code>reflow</code>：<code>render</code>树中一部分或全部元素需要改变尺寸、布局、或着需要隐藏而需要重新构建</li> <li>重绘<code>repaint</code>：<code>render</code>树中一部分元素改变，而不影响布局的，只影响外观的，比如颜色</li> <li>回流必将引起重绘</li></ul> <h5 id="优化方案"><a href="#优化方案" class="header-anchor">#</a> 优化方案</h5> <ul><li>缓存DOM操作    多次DOM变成插入一个<code>createDocumentFragment</code></li> <li>使用<code>window.requestAnimationFrame()</code>，因为它可以把代码推迟到下一次重绘之前执行，而不是立即要求页面重绘。</li> <li>使用虚拟DOM</li></ul> <h5 id="raf"><a href="#raf" class="header-anchor">#</a> RAF</h5> <ul><li><p><strong><code>window.requestAnimationFrame()</code></strong> 告诉浏览器：你希望执行一个动画，并且要求浏览器在下次重绘之前调用指定的回调函数更新动画。</p></li> <li><p>要想动画流畅，更新频率要60帧/s，即16.67ms更新一次视图</p></li> <li><p><code>setTimeout</code> 要手动控制频率，而RAF浏览器会自动控制</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>后台标签或者隐藏在iframe中， <span class="token constant">RAF</span> 会暂停，而setTimeout 依然执行


<span class="token comment">// 3s 把宽度 从100px -&gt; 640px 增加 540px</span>
<span class="token comment">// 60帧/s 3s 180帧 每次变化 3px</span>
<span class="token comment">// 而且当页面切换的时候会暂停执行</span>
<span class="token keyword">const</span> div1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> curWidth <span class="token operator">=</span> <span class="token number">100</span>
<span class="token keyword">const</span> maxWidth <span class="token operator">=</span> <span class="token number">640</span>

<span class="token comment">// setTimeout</span>
<span class="token keyword">function</span> <span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  curWidth <span class="token operator">=</span> curWidth <span class="token operator">+</span> <span class="token number">3</span>
  div1<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> curWidth <span class="token operator">+</span> <span class="token string">'px'</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>curWidth<span class="token punctuation">,</span> div1<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>curWidth <span class="token operator">&lt;</span> maxWidth<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>animate<span class="token punctuation">,</span> <span class="token number">16.7</span><span class="token punctuation">)</span> <span class="token comment">// 这里的animate 没加括号</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// RAF</span>
<span class="token keyword">function</span> <span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  curWidth <span class="token operator">=</span> curWidth <span class="token operator">+</span> <span class="token number">3</span>
  div1<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> curWidth <span class="token operator">+</span> <span class="token string">'px'</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>curWidth<span class="token punctuation">,</span> div1<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>curWidth <span class="token operator">&lt;</span> maxWidth<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animate<span class="token punctuation">)</span> <span class="token comment">// 时间不用自己控制</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="js脚本的异步加载"><a href="#js脚本的异步加载" class="header-anchor">#</a> JS脚本的异步加载</h4> <p><code>Ref</code></p> <ul><li><a href="https://wangdoc.com/javascript/bom/engine.html" target="_blank" rel="noopener noreferrer">浏览器环境概述<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>如何使<code>JS</code>文件在顶部仍然稍后加载呢？</p> <p>常应用在引用了广告和统计的页面中，不会影响、堵塞，更不会影响到到页面其他元素</p> <ul><li><p>使用<code>defer</code></p> <ul><li><code>&lt;script src=&quot;a.js&quot; defer&gt;&lt;/script&gt;</code></li> <li><code>defer</code>的作用是延迟脚本的执行，等到 DOM 加载生成后，再执行脚本</li> <li>浏览器发现带有<code>defer</code>属性的<code>script</code>会继续往下解析 HTML 网页，同时并行下载<code>script</code>的外部脚本，等待网页解析完成再去执行脚本</li></ul></li> <li><p>使用<code>async</code></p> <ul><li><code>&lt;script src=&quot;a.js&quot; async&gt;&lt;/script&gt;</code></li> <li><code>async</code>的作用是使用另一个进程下载脚本，下载时不会阻塞渲染</li> <li>浏览器发现带有<code>async</code>属性的<code>script</code>会继续往下解析 HTML 网页，同时并行下载<code>script</code>的外部脚本。当脚本下载完成会暂停HTML解析，先去执行脚本，执行完再来解析HTML。  这与<code>defer</code>有点差异</li> <li><code>async</code>会无视脚本顺序，优先执行先下载完成的</li> <li>当同时存在<code>defer async</code>的时候 <code>defer</code>将会失效</li></ul></li> <li><p>动态插入 <code>script</code> 标签</p> <ul><li>动态生成的<code>script</code>标签不会阻塞页面渲染，但无法保证脚本的执行顺序</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">[</span><span class="token string">'a.js'</span><span class="token punctuation">,</span> <span class="token string">'b.js'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>通过 <code>ajax</code> 去获取 js 代码，然后通过 eval 执行</li> <li>创建并插入 <code>iframe</code>，让它异步执行 js</li></ul> <p><code>Ref:</code> <a href="https://juejin.cn/post/6844903661139656718" target="_blank" rel="noopener noreferrer"><code>JS脚本异步加载浅析</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="性能优化"><a href="#性能优化" class="header-anchor">#</a> 性能优化</h2> <p><code>Ref</code></p> <ul><li><a href="https://juejin.cn/post/6844904031240863758" target="_blank" rel="noopener noreferrer">2020年了,再不会webpack敲得代码就不香了(近万字实战)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6854573213171580941" target="_blank" rel="noopener noreferrer">你可能不知道的9条Webpack优化策略<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h4 id="性能优化原则"><a href="#性能优化原则" class="header-anchor">#</a> 性能优化原则</h4> <ul><li>多使用内存、缓存或其他方法</li> <li>减少CPU计算量，减少网络请求，减少网络加载耗时</li> <li>空间换时间</li></ul> <h4 id="从何入手"><a href="#从何入手" class="header-anchor">#</a> 从何入手</h4> <h5 id="让加载更快"><a href="#让加载更快" class="header-anchor">#</a> 让加载更快</h5> <ul><li>减少资源体积：压缩代码</li> <li>减少访问次数：合并代码，SSR服务器端渲染，缓存</li> <li>使用更快的网络： CDN</li></ul> <h5 id="让渲染更快"><a href="#让渲染更快" class="header-anchor">#</a> 让渲染更快</h5> <ul><li><code>CSS</code> 放在<code>head</code> ，<code>JS</code>放在<code>body</code>最下面</li> <li>尽早开始执行<code>JS</code>，用<code>DOMContentLoaded</code></li> <li>触发懒加载（图片懒加载，上滑加载更多）</li> <li>对DOM查询进行缓存</li> <li>频繁DOM操作，合并到一起插入 DOM结构</li> <li>节流<code>throttle</code>防抖<code>debounce</code></li></ul> <h4 id="实例"><a href="#实例" class="header-anchor">#</a> 实例</h4> <ul><li><p>资源合并 ==&gt; 请求三次3kb 和请求一次9kb 	3次网络请求--&gt; 1次</p></li> <li><p>缓存 ==&gt; webpack 生成的<code>bundle.[contenthash].js</code></p> <ul><li>如果生成的内容没有发生变化即哈希值没有发生改变 则不需要重新进行请求</li> <li>静态资源加<code>hash</code>后缀，根据文件内容计算<code>hash</code>。如果文件内容不变，则<code>hash</code>不变，则<code>url</code>不变。既然url和文件不变，则会自动触发HTTP缓存机制，返回304</li></ul></li> <li><p><code>CDN</code> ==&gt; 根据地域做网络服务。静态文件 满足304机制</p></li> <li><p><code>SSR</code> ==&gt; 服务器端渲染：网页和数据一起加载，一起渲染</p></li> <li><p>非 <code>SSR</code> ==&gt; （前后端分离）：先加载网页，再加载数据，再渲染数据 (早先的<code>JSP ASP PHP</code> ，现在的<code>vue React</code></p></li> <li><p>懒加载</p> <ul><li>加载<code>loading</code>图片</li> <li>判断哪些图片要加载</li> <li>隐形加载图片</li> <li>替换真图片</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 一张图片就是一个`&lt;img&gt;`标签，浏览器是否发起请求图片是根据`&lt;img&gt;`的`src`属性，所以实现懒加载的关键就是，在图片没有进入可视区域时，先不给`&lt;img&gt;`的`src`赋值，这样浏览器就不会发送请求了，等到图片进入可视区域再给`src`赋值</span>

<span class="token comment">// 可以给img标签统-自定义属性data=src='default.png'，当检测到图片出现在窗口之后再补充src属性，此时才会进行图片资源加载</span>
<span class="token keyword">function</span> <span class="token function">lazyload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> imgs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> len <span class="token operator">=</span> imgs<span class="token punctuation">.</span>length
  <span class="token comment">// 视口高度</span>
  <span class="token keyword">const</span> viewHeight <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientHeight
  <span class="token comment">//滚动务高度</span>
  <span class="token keyword">const</span> scrollHeight <span class="token operator">=</span>
    document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrolltop <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollTop
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> offsetHeight <span class="token operator">=</span> imgs<span class="token punctuation">[</span>i<span class="token punctuation">.</span>offsetTop<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>offsetHeight <span class="token operator">&lt;</span> viewHeight <span class="token operator">+</span> scrollHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> src <span class="token operator">=</span> imgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>src
      imgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>src <span class="token operator">=</span> src
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//可以使用节流优化一下</span>
window<span class="token punctuation">.</span><span class="token function">addEventlListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> lazyload<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><code>Ref</code>：<a href="https://blog.csdn.net/w1418899532/article/details/90515969" target="_blank" rel="noopener noreferrer">js实现图片懒加载原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>缓存DOM查询</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 不缓存 DOM 查询结果</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 每次循环 都会计算length 频繁进行DOM查询</span>
<span class="token punctuation">}</span>

<span class="token comment">// 缓存 DOM 查询结果</span>
<span class="token keyword">const</span> pList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> length <span class="token operator">=</span> pList<span class="token punctuation">.</span>length
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 缓存length 只进行一次 DOM 查询</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>多个DOM操作一起插入到DOM结构：
<ul><li><code>document.createDocumentFragment()</code></li></ul></li> <li>尽早开始<code>JS</code>执行</li> <li><code>document.addEventListener('DOMContentLoaded', function () {}</code></li> <li>防抖节流</li></ul> <h5 id="首屏优化"><a href="#首屏优化" class="header-anchor">#</a> 首屏优化</h5> <ul><li>尽可能的缩小webpack或者其他打包工具生成的包的大小</li> <li>路由懒加载</li> <li>组件按需加载</li> <li>图片懒加载</li> <li>服务端渲染SSR</li> <li>gzip</li></ul> <h5 id="csr-ssr"><a href="#csr-ssr" class="header-anchor">#</a> CSR SSR</h5> <ul><li><code>CSR</code> 客户端渲染</li> <li><code>SSR</code> 服务端渲染
<ul><li>由服务端把渲染的完整的页面返回给客户端，减少了一次客户端到服务端的一次http请求</li> <li>返回完整页面 就利于SEO优化</li> <li>SSR强在首屏渲染。而CSR强在用户和页面多交互的场景</li></ul></li></ul> <h2 id="安全"><a href="#安全" class="header-anchor">#</a> 安全</h2> <h4 id="xss-跨站脚本攻击"><a href="#xss-跨站脚本攻击" class="header-anchor">#</a> <code>XSS</code> 跨站脚本攻击</h4> <h5 id="攻击"><a href="#攻击" class="header-anchor">#</a> 攻击</h5> <blockquote><p>反射型<code>XSS</code></p></blockquote> <ul><li>反射型<code>XSS</code>，非持久化，需要欺骗用户自己去点击链接才能触发<code>XSS</code>代码（服务器中没有这样的页面和内容），一般容易出现在搜索页面。</li></ul> <blockquote><p>存储型<code>XSS</code></p></blockquote> <p>一个博客网站，我发表一篇博客，其中嵌入<code>&lt;script&gt;</code>脚本，脚本内容：获取<code>cookie</code>，发送到我的服务器（服务器配合跨域）。发布这篇博客，有人查看它，我轻松收割访问者的<code>cookie</code>。</p> <h5 id="预防"><a href="#预防" class="header-anchor">#</a> 预防</h5> <blockquote><p>转译字符</p></blockquote> <ul><li>前端要替换，后端也要替换，都做总不会有错</li> <li><code>https://www.npmjs.com/package/xss</code></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">escape</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&amp;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&amp;amp;'</span><span class="token punctuation">)</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&amp;lt;'</span><span class="token punctuation">)</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&amp;gt;'</span><span class="token punctuation">)</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&quot;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&amp;quto;'</span><span class="token punctuation">)</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">'</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&amp;#39;'</span><span class="token punctuation">)</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">`</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&amp;#96;'</span><span class="token punctuation">)</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&amp;#x2F;'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> str
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p><code>HttpOnly</code></p></blockquote> <ul><li>禁止通过<code>document.cookie</code>的方式获取<code>cookies</code></li></ul> <blockquote><p>设置白名单或者黑名单</p></blockquote> <ul><li>对于富文本编辑器 建议使用 白名单</li></ul> <blockquote><p><code>csp</code></p></blockquote> <ul><li><code>Content Security Policy</code>  内容安全策略</li> <li>实质：白名单制度，开发者明确告诉客户端，哪些外部资源可以加载和执行</li></ul> <p>如何启用<code>CSP</code></p> <ul><li>通过 HTTP 头信息的<code>Content-Security-Policy</code>的字段</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Content<span class="token operator">-</span>Security<span class="token operator">-</span>Policy<span class="token operator">:</span> script<span class="token operator">-</span>src <span class="token string">'self'</span><span class="token punctuation">;</span> object<span class="token operator">-</span>src <span class="token string">'none'</span><span class="token punctuation">;</span>
style<span class="token operator">-</span>src cdn<span class="token punctuation">.</span>example<span class="token punctuation">.</span>org third<span class="token operator">-</span>party<span class="token punctuation">.</span>org<span class="token punctuation">;</span> child<span class="token operator">-</span>src https<span class="token operator">:</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>通过网页的<code>&lt;meta&gt;</code>标签</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">&quot;Content-Security-Policy&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;script-src 'self'; object-src 'none'; style-src cdn.example.org third-party.org; child-src https:&quot;</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>如上设置
<ul><li>脚本：只信任当前域名</li> <li><code>&lt;object&gt;</code>标签：不信任任何URL，即不加载任何资源</li> <li>样式表：只信任<code>cdn.example.org</code>和<code>third-party.org</code></li> <li>框架 <code>(frame)</code>：必须使用<code>HTTPS</code>协议加载</li> <li>其他资源：没有限制</li></ul></li></ul> <h4 id="csrf-跨站请求伪造"><a href="#csrf-跨站请求伪造" class="header-anchor">#</a> <code>CSRF</code> 跨站请求伪造</h4> <h5 id="攻击-2"><a href="#攻击-2" class="header-anchor">#</a> 攻击</h5> <p>原理： 诱导用户打开黑客的网站，在黑客的网站中，利用用户登录状态发起跨站点请求。</p> <ol><li>浏览器向网站A发起通信请求</li> <li>网站A验证通过，建立了通信连接，在浏览器存了A的cookie</li> <li>浏览器在未关闭A的连接下访问网站B</li> <li>网站B含有恶意请求代码，向网站A发起请求</li> <li>浏览器根据B发起的请求并且携带A的cookie访问A</li> <li>网站A验证cookie并且响应了这个请求</li></ol> <p>网站B就通过盗用保存在客户端的cookie，以客户端的身份来访问网站A，以客户端身份进行一些非法操作。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>你正在购物，看中了某个商品，商品id是<span class="token number">100</span>
付费接口是xxx<span class="token punctuation">.</span>com<span class="token operator">/</span>pay<span class="token operator">?</span>id<span class="token operator">=</span><span class="token number">100</span>，但没有任何验证
我是攻击者，我看中了一个商品，id是<span class="token number">200</span>

我向你发送一封电子邮件，邮件标题很吸引人
但邮件正文隐藏着<span class="token operator">&lt;</span>img src<span class="token operator">=</span>xxx<span class="token punctuation">.</span>com<span class="token operator">/</span>pay<span class="token operator">?</span>id<span class="token operator">=</span><span class="token number">200</span><span class="token operator">/</span><span class="token operator">&gt;</span>
你一查看邮件，就帮我购买了id是<span class="token number">200</span>的商品
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="预防-2"><a href="#预防-2" class="header-anchor">#</a> 预防</h5> <blockquote><p><code>SameSite</code></p></blockquote> <ul><li><p>对 <code>Cookie</code> 设置 <code>SameSite</code> 属性。表示 <code>Cookie</code> 不随着跨域请求发送，可以很大程度减少 <code>CSRF</code> 的攻击，但是存在兼容性问题。</p> <ul><li><p><code>Strict</code>：所有从当前域发送出来的非同域请求都不会带上<code>cookie</code></p></li> <li><p><code>Lax</code>：就是在GET方式提交表单时会携带<code>cookie，post、iframe/img</code>等标签加载时不会携带<code>cookie</code>。</p></li> <li><p><code>None</code>：关闭<code>SameSite</code>，不过，前提是必须同时设置<code>Secure</code>属性<code>(Cookie 只能通过 HTTPS 协议发送)</code>，否则无效。</p></li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Set<span class="token operator">-</span>Cookie<span class="token operator">:</span> CookieName<span class="token operator">=</span>CookieValue<span class="token punctuation">;</span> SameSite<span class="token operator">=</span>Strict<span class="token punctuation">;</span>
<span class="token comment">//这个规则过于严格，可能造成非常不好的用户体验。</span>
<span class="token comment">//比如，当前网页有一个 GitHub 链接，用户点击跳转就不会带有 GitHub 的 Cookie，跳转过去总是未登陆状态。</span>

Set<span class="token operator">-</span>Cookie<span class="token operator">:</span> CookieName<span class="token operator">=</span>CookieValue<span class="token punctuation">;</span> SameSite<span class="token operator">=</span>Lax<span class="token punctuation">;</span>
<span class="token comment">//Lax规则稍稍放宽，大多数情况也是不发送第三方 Cookie，但是导航到目标网址的 Get 请求除外。</span>

Set<span class="token operator">-</span>Cookie<span class="token operator">:</span> widget_session<span class="token operator">=</span>abc123<span class="token punctuation">;</span> SameSite<span class="token operator">=</span>None<span class="token punctuation">;</span> Secure
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>验证 <code>HTTP Referer</code> 字段</p></blockquote> <ul><li><code>HTTP Referer</code>是<code>header</code>的一部分，当浏览器向web服务器发送请求时，一般会带上<code>Referer</code>信息告诉服务器是从哪个页面链接过来的，服务器籍此可以获得一些信息用于处理。可以通过检查请求的来源来防御<code>CSRF</code>攻击。正常请求的<code>referer</code>具有一定规律，如在提交表单的<code>referer</code>必定是在该页面发起的请求。所以通过检查<code>http</code>包头<code>referer</code>的值是不是这个页面，来判断是不是<code>CSRF</code>攻击。</li> <li><code>Refer</code> 可能被伪造</li></ul> <blockquote><p>在请求地址中添加 <code>token</code> 并验证</p></blockquote> <ul><li><p><code>token</code> 请求拦截 验证是否合法</p></li> <li><p>使用 <code>post</code> 接口</p></li> <li><p>增加验证，例如密码、短信验证码、指纹等</p></li></ul> <h4 id="sql-注入"><a href="#sql-注入" class="header-anchor">#</a> <code>sql</code> 注入</h4> <blockquote><p>权限最小化</p></blockquote> <ul><li>严格限制Web应用的数据库的操作权限，给此用户提供仅仅能够满足其工作的最低权限，从而最大限度的减少注入攻击对数据库的危害。</li></ul> <blockquote><p>正则匹配 字符转义</p></blockquote> <ul><li><code>const reg = /select|update|delete|exec|count|'|&quot;|=|;|&gt;|&lt;|%/i;</code></li></ul> <h4 id="点击劫持"><a href="#点击劫持" class="header-anchor">#</a> 点击劫持</h4> <ul><li>通过覆盖不可见的框架误导受害者点击
<ul><li>使用一个透明的<code>iframe</code>，覆盖在一个网页上，诱使用户在该页面上进行操作</li> <li>使用一张图片覆盖在网页，遮挡网页原有位置的含义</li></ul></li></ul> <p>使用HTTP头  <code>X-Frame-Options</code> 进行攻击防御这个</p> <ul><li><code>deny</code>：表示该页面不允许在 <code>frame</code> 中展示，即便是在相同域名的页面中嵌套也不允许</li> <li><code>sameorigin</code>：表示该页面可以在相同域名页面的 <code>frame</code> 中展示</li> <li><code>allow-form url</code>：表示该页面可以在指定来源的 <code>frame</code> 中展示</li></ul> <p><code>Ref</code></p> <ul><li><a href="https://zhuanlan.zhihu.com/p/83865185" target="_blank" rel="noopener noreferrer">前端安全<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://www.ruanyifeng.com/blog/2016/09/csp.html" target="_blank" rel="noopener noreferrer">Content Security Policy 入门教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6951571103953190925" target="_blank" rel="noopener noreferrer">一、web安全（xss/csrf）简单攻击原理和防御方案（理论篇）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Honjaychang/Honjaychang.github.io/issues/new#/edit/master/interview/HTTP-Browser.md" target="_blank" rel="noopener noreferrer">纠错/留言/交流</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/13/2021, 11:39:28 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/interview/Web-API.html" class="prev">
        Web-API
      </a></span> <span class="next"><a href="/interview/network.html">
        计网
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8db34c63.js" defer></script><script src="/assets/js/2.983698d7.js" defer></script><script src="/assets/js/34.3b003f35.js" defer></script>
  </body>
</html>
